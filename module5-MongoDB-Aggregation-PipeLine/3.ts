

// ржарж┐ржХ ржЖржЫрзЗ тАФ ржПржЦржи ржЖржорж┐ ржЖржкржирж╛ржХрзЗ **MongoDB Aggregation Pipeline** ржПрж░ `$group`, `$sum`, ржЖрж░ `$push` ржмрж╛ржВрж▓рж╛ржпрж╝ ржмрзНржпрж╛ржЦрзНржпрж╛ ржХрж░ржмрзЛ, рж╕рж╛ржерзЗ ржЙржжрж╛рж╣рж░ржг ржжрзЗржмрзЛ ржпрж╛рждрзЗ рж╕рж╣ржЬрзЗ ржмрзБржЭрждрзЗ ржкрж╛рж░рзЗржиред

// ---

// ## **1я╕ПтГг `$group`**

// **ржХрж╛ржЬ:**
// ржбржХрзБржорзЗржирзНржЯржЧрзБрж▓рзЛржХрзЗ **ржПржХржЯрж╛ ржЧрзНрж░рзБржкрж┐ржВ ржХрзА** (ржпрзЗржоржи `category`, `department`) ржЕржирзБржпрж╛ржпрж╝рзА ржЧрзНрж░рзБржк ржХрж░рзЗ, рждрж╛рж░ржкрж░ ржкрзНрж░рждрж┐ржЯрж╛ ржЧрзНрж░рзБржкрзЗрж░ ржЬржирзНржп ржХрж┐ржЫрзБ рж╣рж┐рж╕рж╛ржм-ржирж┐ржХрж╛рж╢ (count, sum, avg ржЗрждрзНржпрж╛ржжрж┐) ржХрж░рзЗред

// **Syntax:**

// ```js
// { 
//   $group: { 
//     _id: <group_by_field>, 
//     <ржирждрзБржи_ржлрж┐рж▓рзНржб>: { <accumulator>: <expression> } 
//   } 
// }
// ```

// * `_id` тЖТ ржпрзЗржЗ ржлрж┐рж▓рзНржб ржжрж┐ржпрж╝рзЗ ржЧрзНрж░рзБржк ржХрж░ржмрзЗржи (ржмрж╛ ржПржХрж╛ржзрж┐ржХ ржлрж┐рж▓рзНржбржУ рж╣рждрзЗ ржкрж╛рж░рзЗ)
// * `<accumulator>` тЖТ `$sum`, `$avg`, `$push` ржЗрждрзНржпрж╛ржжрж┐

// ---

// ## **2я╕ПтГг `$sum`**

// **ржХрж╛ржЬ:**

// * ржЧрзНрж░рзБржкрзЗ ржерж╛ржХрж╛ ржбржХрзБржорзЗржирзНржЯржЧрзБрж▓рзЛрж░ рж╕ржВржЦрзНржпрж╛ ржЧржгржирж╛ ржХрж░рждрзЗ ржмрж╛
// * ржХрзЛржирзЛ ржлрж┐рж▓рзНржбрзЗрж░ ржорзЛржЯ ржпрзЛржЧржлрж▓ ржмрзЗрж░ ржХрж░рждрзЗ

// **Syntax:**

// ```js
// { $sum: <number_or_expression> }
// ```

// **ржЙржжрж╛рж╣рж░ржг 1 тАФ рж╢рзБржзрзБ ржЧржгржирж╛ (count):**

// ```js
// db.orders.aggregate([
//   { $group: { _id: "$customerId", totalOrders: { $sum: 1 } } }
// ])
// ```

// тЮб ржПржЦрж╛ржирзЗ `$sum: 1` ржорж╛ржирзЗ ржкрзНрж░рждрж┐ржЯрж╛ ржбржХрзБржорзЗржирзНржЯрзЗрж░ ржЬржирзНржп рзз ржпрзЛржЧ рж╣ржмрзЗ тЖТ ржорзЛржЯ ржЕрж░рзНржбрж╛рж░рзЗрж░ рж╕ржВржЦрзНржпрж╛ред

// **ржЙржжрж╛рж╣рж░ржг 2 тАФ ржорзЛржЯ ржЯрж╛ржХрж╛рж░ ржпрзЛржЧржлрж▓:**

// ```js
// db.orders.aggregate([
//   { $group: { _id: "$customerId", totalAmount: { $sum: "$amount" } } }
// ])
// ```

// тЮб ржПржЦрж╛ржирзЗ `$sum: "$amount"` ржорж╛ржирзЗ ржкрзНрж░рждрж┐ржЯрж╛ ржЕрж░рзНржбрж╛рж░рзЗрж░ `amount` ржпрзЛржЧ рж╣ржмрзЗред

// ---

// ## **3я╕ПтГг `$push`**

// **ржХрж╛ржЬ:**
// ржкрзНрж░рждрж┐ржЯрж╛ ржЧрзНрж░рзБржкрзЗ ржерж╛ржХрж╛ ржбржХрзБржорзЗржирзНржЯрзЗрж░ ржХрзЛржирзЛ ржлрж┐рж▓рзНржбрзЗрж░ ржорж╛ржи **ржПржХржЯрж╛ ржЕрзНржпрж╛рж░рзЗрждрзЗ** ржЬржорж╛ ржХрж░рж╛ред

// **Syntax:**

// ```js
// { $push: <expression> }
// ```

// **ржЙржжрж╛рж╣рж░ржг:**

// ```js
// db.orders.aggregate([
//   { 
//     $group: { 
//       _id: "$customerId", 
//       allProducts: { $push: "$productName" } 
//     } 
//   }
// ])
// ```

// тЮб ржПржЦрж╛ржирзЗ ржкрзНрж░рждрж┐ржЯрж╛ ржХрж╛рж╕рзНржЯржорж╛рж░рзЗрж░ рж╕ржм ржкрзНрж░рзЛржбрж╛ржХрзНржЯрзЗрж░ ржирж╛ржо ржПржХрж╕рж╛ржерзЗ ржПржХржЯрж╛ ржЕрзНржпрж╛рж░рзЗрждрзЗ ржЪрж▓рзЗ ржЖрж╕ржмрзЗред

// ---

// ## **ЁЯОп ржлрзБрж▓ ржЙржжрж╛рж╣рж░ржг**

// ржзрж░рзБржи `sales` ржХрж╛рж▓рзЗржХрж╢ржирзЗ ржЖржЫрзЗ:

// ```json
// [
//   { "category": "Electronics", "product": "Laptop",  "price": 1000 },
//   { "category": "Electronics", "product": "Phone",   "price": 800 },
//   { "category": "Clothing",    "product": "Shirt",   "price": 50 },
//   { "category": "Clothing",    "product": "Jeans",   "price": 60 }
// ]
// ```

// Aggregation:

// ```js
// db.sales.aggregate([
//   {
//     $group: {
//       _id: "$category",
//       totalSales: { $sum: "$price" },
//       products: { $push: "$product" }
//     }
//   }
// ])
// ```

// **Result:**

// ```json
// [
//   {
//     "_id": "Electronics",
//     "totalSales": 1800,
//     "products": ["Laptop", "Phone"]
//   },
//   {
//     "_id": "Clothing",
//     "totalSales": 110,
//     "products": ["Shirt", "Jeans"]
//   }
// ]
// ```

// ---

// ржЖржкржирж┐ ржЪрж╛ржЗрж▓рзЗ ржЖржорж┐ ржПрж░ рж╕рж╛ржерзЗ `$avg` ржЖрж░ `$addToSet` ржпрзЛржЧ ржХрж░рзЗ ржжрзЗржЦрж╛рждрзЗ ржкрж╛рж░рж┐, ржпрзЗржЧрзБрж▓рзЛ `$sum` ржЖрж░ `$push` ржПрж░ ржХрж╛ржЫрж╛ржХрж╛ржЫрж┐ ржХрж╛ржЬ ржХрж░рзЗ ржХрж┐ржирзНрждрзБ ржХрж┐ржЫрзБ ржкрж╛рж░рзНржержХрзНржп ржЖржЫрзЗред
// ржЖржкржирж┐ ржХрж┐ ржЪрж╛ржи ржЖржорж┐ рж╕рзЗржЯрж╛ ржХрж░рзЗ ржжрж┐ржЗ?





//  db.test.aggregate([
     
     
//      {$group: { _id: "$age",totalAge:{$sum:1}}}
     
     
//      ])


// db.test.aggregate([
     
     
//      {$group: { _id: "$age",totalAge:{$sum:1},allName:{$push:"$name"}}}
     
     
//      ])










// if want to push all document an array  use ($$ROOT)


//  db.test.aggregate([
     
     
//      {$group: { _id: "$age",count:{$sum:1},totalAge:{$sum:"$age"},allDocuments:{$push:"$$ROOT"}}}
     
     
//      ])




        